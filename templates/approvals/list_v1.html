{% extends "base.html" %} {% block title %}簽核清單 - {{ super() if super else
'OneTouch' }}{% endblock %} {% block content %}
<style>
  .wrap {
    max-width: 1100px;
    margin: auto;
    padding: 8px;
  }
  .card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
    padding: 14px;
    margin-bottom: 12px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th,
  td {
    border-bottom: 1px solid #eee;
    padding: 8px;
    text-align: left;
  }
  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid #ddd;
    font-size: 12px;
  }
  .ok {
    background: #ecfdf5;
  }
  .warn {
    background: #fffbeb;
  }
  .muted {
    color: #6b7280;
  }
</style>
<div class="wrap">
  <div class="card">
    <div
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <h2>🖊️ 我需要簽</h2>
      <a class="badge" href="/approvals/new">➕ 建立簽核單</a>
    </div>
    {% if my_todo and my_todo|length>0 %}
    <table>
      <thead>
        <tr>
          <th>主旨</th>
          <th>送簽人</th>
          <th>目前關卡</th>
          <th>送簽時間</th>
        </tr>
      </thead>
      <tbody>
        {% for r in my_todo %}
        <tr
          onclick="location.href='/approvals/{{ r.id }}'"
          style="cursor: pointer"
        >
          <td>{{ r.subject }}</td>
          <td>{{ r.requester }}</td>
          <td>#{{ r.step + 1 }}</td>
          <td class="muted">{{ r.submitted_at }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="muted">目前沒有待簽事項。</p>
    {% endif %}
  </div>

  <div class="card">
    <h2>📤 我送簽</h2>
    {% if my_sent and my_sent|length>0 %}
    <table>
      <thead>
        <tr>
          <th>主旨</th>
          <th>狀態</th>
          <th>目前關卡</th>
          <th>送簽時間</th>
        </tr>
      </thead>
      <tbody>
        {% for r in my_sent %}
        <tr
          onclick="location.href='/approvals/{{ r.id }}'"
          style="cursor: pointer"
        >
          <td>{{ r.subject }}</td>
          <td>
            {% if r.status=='approved' %}<span class="badge ok">完成</span> {%
            elif r.status=='rejected' %}<span class="badge warn">退回</span> {%
            else %}<span class="badge">進行中</span>{% endif %}
          </td>
          <td>
            {% if r.current_step>=0 %}#{{ r.current_step + 1 }}{% else %}-{%
            endif %}
          </td>
          <td class="muted">{{ r.submitted_at }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="muted">尚未送出簽核。</p>
    {% endif %}
  </div>
</div>
{% endblock %}
