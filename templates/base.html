<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}OneTouch Portal{% endblock %}</title>
    <!-- ç¢ºä¿ä½¿ç”¨ url_for ä¾†ç”Ÿæˆéœæ…‹æª”æ¡ˆçš„è·¯å¾‘ -->
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="app-container">
      <!-- å¼•å…¥å…±ç”¨çš„å°è¦½åˆ— -->
      {% if user %} {% include '_navbar.html' %} {% endif %}

      <main class="main-content">
        <header class="header">
          <!--div class="header-left">
            <img
              src="{{ url_for('static', path='logo.png') }}"
              alt="Logo"
              class="logo"
            />
            <strong>OneTouch Portal</strong>
          <div-->
          <!-- æˆ‘å€‘å°‡åŸæœ¬å³å´çš„è³‡è¨Šç§»åˆ°é€™è£¡ï¼Œä¸¦ç§»é™¤é€£çµ -->
          {% if user %}
          <div class="header-user-info">
            <!-- span>æ­¡è¿, {{ user }} ({{role}})</span-->
            <span><strong>ğŸ‘‹ æ­¡è¿å›ä¾†, {{ user }}! è«‹å¾å·¦å´çš„åŠŸèƒ½åˆ—é¸æ“‡æ‚¨è¦ä½¿ç”¨çš„æœå‹™ã€‚</strong></span>
            
</p>
          </div>
          {% endif %}
        </header>

        <div class="page-content">
          <!-- é€™è£¡æ˜¯å­æ¨¡æ¿å…§å®¹çš„æ’å…¥é» -->
          {% block content %}{% endblock %}
        </div>
      </main>
    </div>
    <!-- ===== æ›´æ–°å¾Œçš„ JavaScript å€å¡Š ===== -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const appContainer = document.querySelector(".app-container");
        const sidebarToggle = document.getElementById("sidebar-toggle");

        // --- å­é¸å–®é‚è¼¯ (ä¿ç•™) ---
        const submenuToggles = document.querySelectorAll(
          ".sidebar .has-submenu > a"
        );
        submenuToggles.forEach(function (toggle) {
          toggle.addEventListener("click", function (event) {
            // å¦‚æœå´é‚Šæ¬„æ˜¯æ”¶åˆçš„ï¼Œå°±ä¸è¦åŸ·è¡Œå­é¸å–®çš„å±•é–‹å‹•ä½œ
            if (appContainer.classList.contains("sidebar-collapsed")) {
              return;
            }
            event.preventDefault();
            const parentLi = this.parentElement;
            parentLi.classList.toggle("open");
          });
        });

        const activeSubmenuLink = document.querySelector(".submenu a.active");
        if (activeSubmenuLink) {
          const parentSubmenu = activeSubmenuLink.closest(".has-submenu");
          if (parentSubmenu) {
            parentSubmenu.classList.add("open");
          }
        }

        // --- å´é‚Šæ¬„æ”¶åˆé‚è¼¯ (æ–°å¢) ---
        if (sidebarToggle) {
          // 1. é é¢è¼‰å…¥æ™‚ï¼Œæª¢æŸ¥ localStorage æ˜¯å¦æœ‰å·²å­˜çš„ç‹€æ…‹
          if (localStorage.getItem("sidebarCollapsed") === "true") {
            appContainer.classList.add("sidebar-collapsed");
          }

          // 2. ç›£è½æŒ‰éˆ•é»æ“Š
          sidebarToggle.addEventListener("click", function (event) {
            event.preventDefault();
            appContainer.classList.toggle("sidebar-collapsed");

            // 3. å°‡æ–°ç‹€æ…‹å­˜å…¥ localStorage
            const isCollapsed =
              appContainer.classList.contains("sidebar-collapsed");
            localStorage.setItem("sidebarCollapsed", isCollapsed);
          });
        }
      });
    </script>
    <!-- ================================ -->
  </body>
</html>
