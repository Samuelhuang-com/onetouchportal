{% extends "base.html" %} {% block title %}ç‡Ÿæ¥­æ—¥èªŒ - {{ super() }}{% endblock
%} {% block content %}
<style>
  .responsive-table {
    overflow-x: auto;
    width: 100%;
    margin-top: 1rem;
    border-collapse: collapse;
  }
  .responsive-table th,
  .responsive-table td {
    white-space: nowrap;
    padding: 8px 12px;
    border: 1px solid #ddd;
  }
  .form-inline {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    margin-bottom: 1rem;
  }
  @media (max-width: 600px) {
    .form-inline {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>

<div class="page-header">
  <h2>ğŸ“„ ç‡Ÿæ¥­æ—¥èªŒå ±è¡¨</h2>
</div>
æœ¬æœˆé ç®—/å¤©æ•¸    2,800,000&nbsp;&nbsp;    æ¯æ—¥ç‡Ÿæ”¶é ç®— 93,500 &nbsp;&nbsp;
æœ¬æœˆé…’æ°´é ç®—/å¤©æ•¸  200,000&nbsp;&nbsp;    æ¯æ—¥é…’æ°´é ç®—  6,500 

<form method="get" action="/report" class="form-inline">
  <label for="date"
    >é¸æ“‡æ—¥æœŸï¼š
    <input
      type="date"
      name="date"
      id="date"
      value="{{ request.query_params.date or '' }}"
      required
      style="padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px"
    />
  </label>
  <button type="submit" class="button">ğŸ” æŸ¥è©¢</button>
</form>

{% if report_date %}
<hr />
<h3>ğŸ“… å ±è¡¨æ—¥æœŸï¼š{{ report_date }}ã€€ğŸ“{{ branch }}</h3>

<div class="responsive-table">
  <table>
    <thead>
      <tr>
        <th>é¤åˆ¥</th>
        <th>ä¾†å®¢æ•¸</th>
        <th>é¤é£Ÿæ”¶å…¥</th>
        <th>é£²æ–™æ”¶å…¥</th>
        <th>å…¶ä»–æ”¶å…¥</th>
        <th>æœå‹™è²»</th>
        <th>ç¸½æ”¶å…¥</th>
        <th>å¹³å‡æ¶ˆè²»</th>
      </tr>
    </thead>
    <tbody>
      {% for r in records %}
      <tr>
        <td>{{ r.Meal }} {{ r.Meal_Chinese }}</td>
        <td align="right">{{ r.Covers }}</td>
        <td align="right">{{ r.FoodRev }}</td>
        <td align="right">{{ r.BevRev }}</td>
        <td align="right">{{ r.OthersRev }}</td>
        <td align="right">{{ r.SvcCharge }}</td>
        <td align="right">{{ r.TotalFB }}</td>
        <td align="right">{{ r.AvgCheck }}</td>
      </tr>
      {% endfor %}
      <tr style="font-weight: bold; background: #f0f0f0">
        <td>Total ç¸½è¨ˆ</td>
        <td align="right">{{ totals.Covers }}</td>
        <td align="right">{{ totals.FoodRev }}</td>
        <td align="right">{{ totals.BevRev }}</td>
        <td align="right">{{ totals.OthersRev }}</td>
        <td align="right">{{ totals.SvcCharge }}</td>
        <td align="right">{{ totals.TotalFB }}</td>
        <td align="right">{{ totals.AvgCheck }}</td>
      </tr>
    </tbody>
  </table>
</div>

<div style="margin-top: 20px">
  <strong>MTD æœˆç´¯è¨ˆæ”¶å…¥ï¼š</strong>{{ mtd_revenue }}&nbsp;&nbsp;
    <strong>æœ¬æœˆé”æˆç‡ï¼š</strong>{{ rates.mtd_rate | percent }}&nbsp;&nbsp;
    <p><strong>æœ¬æœˆç´¯è¨ˆé”æˆç‡ï¼š</strong>{{ rates.accumulated_mtd_rate | percent }}</p>&nbsp;&nbsp;
    <strong>æ¯æ—¥é”æˆç‡ï¼š</strong>{{ rates.day_rate | percent }}&nbsp;&nbsp;
    <strong>é…’æ°´é”æˆç‡ï¼š</strong>{{ rates.bev_rate | percent }}
  </p>
</div>

<canvas id="revenueChart" height="100"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('revenueChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: {{ chart_data.labels | tojson }},
    datasets: [
      {
        label: 'æ¯æ—¥ç¸½æ”¶å…¥',
        data: {{ chart_data.total | tojson }},
        borderColor: 'blue',
        backgroundColor: 'rgba(0, 0, 255, 0.1)',
        tension: 0.3
      },
      {
        label: 'å¹³å‡æ¶ˆè²»',
        data: {{ chart_data.avgcheck | tojson }},
        borderColor: 'orange',
        borderDash: [5, 5],
        yAxisID: 'y1'
      }
    ]
  },
  options: {
    responsive: true,
    scales: {
      y: {
        title: { display: true, text: 'æ”¶å…¥ (å…ƒ)' }
      },
      y1: {
        position: 'right',
        grid: { drawOnChartArea: false },
        title: { display: true, text: 'å¹³å‡æ¶ˆè²»' }
      }
    },
    plugins: {
      legend: { position: 'bottom' }
    }
  }
});
</script>


{% endif %} {% endblock %}
