{% extends "base.html" %} {% block title %}å…¬å‘Šç®¡ç† - {{ super() }}{% endblock
%} {% block content %}
<!-- 1. è¼‰å…¥ Quill.js çš„ CSS æ¨£å¼è¡¨ -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />

<!-- 2. è¼‰å…¥ Quill.js çš„æ ¸å¿ƒç¨‹å¼ -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<style>
  .announcement-form {
    background: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 2rem;
  }
  .announcement-form .form-group {
    margin-bottom: 1rem;
  }
  .announcement-form label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
  .announcement-form input[type="text"] {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }
  /* Quill ç·¨è¼¯å™¨çš„æ¨£å¼ */
  #editor {
    height: 350px;
    background-color: #fff;
  }
  .announcement-list {
    list-style: none;
    padding: 0;
  }
  .announcement-item {
    background: #fff;
    border: 1px solid #ddd;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 20px;
  }
  .announcement-item-content {
    flex-grow: 1;
    word-break: break-word;
  }
  .announcement-item-content h4 {
    margin-top: 0;
    margin-bottom: 5px;
    color: #337ab7;
  }
  .announcement-item-content .content-body {
    margin: 0;
  }
  .announcement-item-meta {
    font-size: 0.85em;
    color: #777;
    margin-top: 10px;
  }
  .announcement-item-actions {
    flex-shrink: 0;
  }
</style>

<h3>ğŸ“¢ ç™¼å¸ƒæ–°å…¬å‘Š</h3>
<div class="announcement-form">
  <!-- 3. ä¿®æ”¹è¡¨å–®ï¼ŒåŠ å…¥ id ä»¥ä¾¿ JavaScript é¸å– -->
  <form action="/announcements/add" method="post" id="announcement-form">
    <div class="form-group">
      <label for="title">æ¨™é¡Œ</label>
      <input type="text" id="title" name="title" required />
    </div>
    <div class="form-group">
      <label for="content">å…§å®¹</label>
      <!-- 4. é€™æ˜¯ Quill ç·¨è¼¯å™¨å°‡æœƒç”Ÿæˆçš„åœ°æ–¹ -->
      <div id="editor"></div>
      <!-- 5. æ–°å¢ä¸€å€‹éš±è—çš„ inputï¼Œç”¨ä¾†å„²å­˜ Quill çš„ HTML å…§å®¹ä¸¦æäº¤çµ¦å¾Œç«¯ -->
      <input type="hidden" name="content" id="content-input" />
    </div>
    <button type="submit" class="button">ç™¼å¸ƒå…¬å‘Š</button>
  </form>
</div>

<hr />

<h3>ğŸ“‹ ç¾æœ‰å…¬å‘Šåˆ—è¡¨</h3>
<ul class="announcement-list">
  {% for ann in announcements %}
  <li class="announcement-item">
    <div class="announcement-item-content">
      <h4>{{ ann.title }}</h4>
      <div class="content-body">{{ ann.content | safe }}</div>
      <div class="announcement-item-meta">
        <span>ç™¼å¸ƒäºº: {{ ann.author }}</span> |
        <span
          >æ™‚é–“: {{ ann.timestamp.split('T')[0] }} {{
          ann.timestamp.split('T')[1].split('.')[0] }}</span
        >
      </div>
    </div>
    <div class="announcement-item-actions">
      <form
        action="/announcements/delete"
        method="post"
        onsubmit="return confirm('æ‚¨ç¢ºå®šè¦åˆªé™¤é€™å‰‡å…¬å‘Šå—ï¼Ÿ');"
      >
        <input type="hidden" name="announcement_id" value="{{ ann.id }}" />
        <button type="submit" class="button-danger" title="åˆªé™¤å…¬å‘Š">ğŸ—‘ï¸</button>
      </form>
    </div>
  </li>
  {% else %}
  <li><p>ç›®å‰æ²’æœ‰ä»»ä½•å…¬å‘Šã€‚</p></li>
  {% endfor %}
</ul>

<!-- 6. åˆå§‹åŒ– Quill.js çš„è…³æœ¬ -->
<script>
  // å®šç¾©ç·¨è¼¯å™¨çš„å·¥å…·åˆ—é¸é …
  var toolbarOptions = [
    [{ header: [1, 2, 3, 4, 5, 6, false] }],
    [{ font: [] }],
    ["bold", "italic", "underline", "strike"], // ç²—é«”ã€æ–œé«”ã€åº•ç·šã€åˆªé™¤ç·š
    [{ color: [] }, { background: [] }], // æ–‡å­—é¡è‰²ã€èƒŒæ™¯é¡è‰²
    [{ align: [] }],
    ["blockquote", "code-block"],
    [{ list: "ordered" }, { list: "bullet" }],
    [{ indent: "-1" }, { indent: "+1" }], // ç¸®æ’
    ["link", "image"], // é€£çµã€åœ–ç‰‡
    ["clean"], // æ¸…é™¤æ ¼å¼
  ];

  // åˆå§‹åŒ– Quill ç·¨è¼¯å™¨
  var quill = new Quill("#editor", {
    modules: {
      toolbar: toolbarOptions,
    },
    theme: "snow", // ä½¿ç”¨ 'snow' é€™å€‹ä¸»é¡Œ
  });

  // ç›£è½è¡¨å–®æäº¤äº‹ä»¶
  var form = document.getElementById("announcement-form");
  form.onsubmit = function () {
    // ç•¶ä½¿ç”¨è€…é»æ“Šã€Œç™¼å¸ƒå…¬å‘Šã€æ™‚ï¼Œ
    // å¾ Quill ç·¨è¼¯å™¨ä¸­å–å¾— HTML å…§å®¹
    var content = document.querySelector(".ql-editor").innerHTML;
    // å°‡å…§å®¹æ”¾å…¥æˆ‘å€‘éš±è—çš„ input ä¸­
    document.getElementById("content-input").value = content;
  };
</script>

{% endblock %}
