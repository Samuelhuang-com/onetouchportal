{% extends "base.html" %} {% block title %}è¨‚ä½ç´€éŒ„ - {{ super() }}{% endblock
%} {% block content %}
<div class="page-header">
  <h2>ğŸ“‹ è¨‚ä½ç´€éŒ„ç¸½è¦½</h2>
</div>

<!-- æœå°‹èˆ‡åˆ‡æ›é–‹é—œ -->
<div style="margin-bottom: 20px">
  <input
    type="text"
    id="searchInput"
    onkeyup="filterTable()"
    placeholder="ğŸ” æœå°‹å§“åã€é›»è©±ã€åœ°é»ã€ç‹€æ…‹ç­‰é—œéµå­—..."
    style="
      width: 70%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    "
  />
  <label style="margin-left: 15px">
    <input type="checkbox" id="toggleCancelled" onchange="filterTable()" />
    é¡¯ç¤ºå–æ¶ˆèˆ‡ No Show è³‡æ–™
  </label>
</div>

<table id="reservationTable">
  <thead>
    <tr>
      <th>åœ°é»</th>
      <th>æ™‚é–“</th>
      <th>å®¢äººå§“å</th>
      <th>äººæ•¸</th>
      <th>é¤æœŸ</th>
      <th>é›»è©±</th>
      <th>Email</th>
      <th>ç‹€æ…‹</th>
      <th>ä¾†æº</th>
      <th>å‚™è¨»</th>
    </tr>
  </thead>
  <tbody>
    {% set grouped = {} %} {% for r in reservations %} {% set _ =
    grouped.setdefault(r.location, []).append(r) %} {% endfor %} {% for
    location, items in grouped.items() %} {% set counts = {'å·²å…¥åº§': 0,
    'å®¢äººä¿ç•™': 0, 'å·²é€šçŸ¥': 0, 'æœªå…¥åº§': 0, 'å…¶ä»–': 0} %} {% for r in items %}
    {% if r.state not in ['No Show', 'å®¢äººå–æ¶ˆ', 'é¤å»³å–æ¶ˆ'] %} {% if r.state in
    counts %} {% set _ = counts.update({r.state: counts[r.state] + 1}) %} {%
    else %} {% set _ = counts.update({'å…¶ä»–': counts['å…¶ä»–'] + 1}) %} {% endif
    %} {% endif %} {% endfor %} {% for r in items %}
    <tr
      class="{% set base = '' %} {% if r.state == 'å®¢äººå–æ¶ˆ' %}status-cancelled hidden-cancelled {% elif r.state == 'é¤å»³å–æ¶ˆ' %}status-restaurant-cancelled hidden-cancelled {% elif r.state == 'No Show' %}status-no-show hidden-cancelled {% elif r.state == 'å·²å…¥åº§' %}status-seated {% elif r.state == 'å®¢äººä¿ç•™' %}status-reserved {% elif r.state == 'å·²é€šçŸ¥' %}status-notified {% elif r.state == 'æœªå…¥åº§' %}status-unseated {% endif %}"
    >
      <td>{{ location }}</td>
      <td>{{ r.rsvTime }}</td>
      <td>{{ r.partonName }}</td>
      <td>{{ r.adults }}/{{ r.kids }}</td>
      <td>{{ r.diningPeriod }}</td>
      <td>{{ r.phoneNumber }}</td>
      <td>{{ r.email }}</td>
      <td>{{ r.state }}</td>
      <td>{{ r.source }}</td>
      <td>{{ r.note }}</td>
    </tr>
    {% endfor %}

    <tr style="background-color: #f2f2f2; font-weight: bold">
      <td colspan="10">
        ğŸ“Œ <strong>{{ location }} å°è¨ˆï¼š</strong>
        âœ… å·²å…¥åº§ï¼š{{ counts['å·²å…¥åº§'] }}ã€ â³ å®¢äººä¿ç•™ï¼š{{ counts['å®¢äººä¿ç•™']
        }}ã€ ğŸ”” å·²é€šçŸ¥ï¼š{{ counts['å·²é€šçŸ¥'] }}ã€ ğŸ•’ æœªå…¥åº§ï¼š{{ counts['æœªå…¥åº§']
        }}ã€ ğŸŒ€ å…¶ä»–ï¼š{{ counts['å…¶ä»–'] }}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  function filterTable() {
    const keyword = document.getElementById("searchInput").value.toLowerCase();
    const showCancelled = document.getElementById("toggleCancelled").checked;

    const rows = document.querySelectorAll("#reservationTable tbody tr");

    rows.forEach((row) => {
      const isCancelled = row.classList.contains("hidden-cancelled");
      const text = row.textContent.toLowerCase();

      // æ±ºå®šæ˜¯å¦é¡¯ç¤º
      const matchSearch = text.includes(keyword);
      const showRow = matchSearch && (showCancelled || !isCancelled);

      row.style.display = showRow ? "" : "none";
    });
  }
</script>
{% endblock %}
