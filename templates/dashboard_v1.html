{% extends "base.html" %} {% block title %}ä¸»æ§å° - {{ super() }}{% endblock %}
{% block content %}
<!-- è¼‰å…¥å„€è¡¨ç›¤åœ–æ‰€éœ€çš„ JavaScript å‡½å¼åº« -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.4.0/justgage.min.js"></script>

<style>
  .dashboard-grid {
    display: grid;
    /* åœ¨ä¸­ç­‰è¢å¹•å¯¬åº¦ä»¥ä¸Šè®Šç‚ºå…©æ¬„ */
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
  }
  .dashboard-card {
    background-color: #fff;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
  }
  .dashboard-card h3 {
    margin-top: 0;
    border-bottom: 2px solid #f4f4f4;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  /* KPI å¡ç‰‡æ¨£å¼ */
  .kpi-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  .kpi-item {
    text-align: center;
  }
  .kpi-item h4 {
    margin: 0 0 0.5rem 0;
    color: #555;
    font-size: 1em;
  }
  /* é€²åº¦æ¢æ¨£å¼ */
  .progress-bar {
    width: 100%;
    height: 25px;
    background-color: #e9ecef;
    border-radius: 0.375rem;
    overflow: hidden;
    position: relative;
  }
  .progress-bar-fill {
    height: 100%;
    background-color: #007bff;
    border-radius: 0.375rem;
    transition: width 0.6s ease;
  }
  .progress-bar-text {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: bold;
    text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
  }
  /* å„€è¡¨ç›¤å®¹å™¨ */
  #gauge {
    width: 100%;
    height: 200px;
  }
  /* å…¬å‘Šæ¨£å¼ */
  .announcement-list {
    list-style-type: none;
    padding: 0;
  }
  .announcement-item {
    padding: 1rem 0;
    border-bottom: 1px solid #eee;
  }
  .announcement-item:last-child {
    border-bottom: none;
  }
  .announcement-title {
    font-weight: bold;
    color: #337ab7;
    font-size: 1.2em;
    margin-bottom: 0.5rem;
  }
  .announcement-content {
    word-break: break-word;
  }
  .announcement-meta {
    font-size: 0.8em;
    color: #888;
    margin-top: 1rem;
  }
</style>

<div class="welcome-card">
  <h2>æ­¡è¿ä¾†åˆ° <strong>åœ‹è¯</strong> OneTouch Portalï¼</h2>
</div>

<div class="dashboard-grid">
  <!-- å·¦å´ KPI å¡ç‰‡ -->
  <div class="dashboard-card">
    <h3>ğŸ“Š æ¿çŸ³å’–å•¡å»³ç‡Ÿæ”¶ (KPIs)</h3>
    <div class="kpi-container">
      <!-- ç•¶æ—¥ç‡Ÿæ”¶é€²åº¦æ¢ -->
      <div class="kpi-item">
        <h4>ä»Šæ—¥ç‡Ÿæ”¶é€²åº¦</h4>
        {% set day_progress = (kpis.today_revenue / kpis.daily_budget * 100 |
        round(2)) if kpis.daily_budget else 0 %}
        <div class="progress-bar">
          <div
            class="progress-bar-fill"
            style="width: {{ day_progress | round(2) }}%;"
          ></div>
          <div class="progress-bar-text">
            {{ kpis.today_revenue | number }} / {{ kpis.daily_budget | number }}
          </div>
        </div>
      </div>
      <!-- æœ¬æœˆé”æˆç‡å„€è¡¨ç›¤ -->
      <div class="kpi-item">
        <h4>æœ¬æœˆç‡Ÿæ”¶é”æˆç‡</h4>
        <div id="gauge"></div>
      </div>
    </div>
  </div>

  <!-- å³å´å…¬å‘Šå¡ç‰‡ -->
  <div class="dashboard-card">
    <h3>ğŸ“¢ æœ€æ–°å…¬å‘Š</h3>
    {% if announcements %}
    <ul class="announcement-list">
      {% for ann in announcements %}
      <li class="announcement-item">
        <div class="announcement-title">{{ ann.title }}</div>
        <div class="announcement-content">{{ ann.content | safe }}</div>
        <div class="announcement-meta">
          ç”± {{ ann.author }} ç™¼å¸ƒæ–¼ {{ ann.timestamp.split('T')[0] }}
        </div>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p>ç›®å‰æ²’æœ‰ä»»ä½•å…¬å‘Šã€‚</p>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var mtd_rate = {{ kpis.mtd_achievement_rate * 100 }};

    var g = new JustGage({
      id: "gauge",
      value: mtd_rate,
      min: 0,
      max: 100,
      title: " ",
      label: "%",
      levelColors: ["#ff0000", "#f9c802", "#a9d70b"], // ç´…ã€é»ƒã€ç¶ 
      formatNumber: true,
      decimals: 2,
      humanFriendlyDecimal: 2
    });
  });
</script>

{% endblock %}
