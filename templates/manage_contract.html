{% extends "base.html" %}
{% block title %}ç¶­è­·åˆç´„ - {{ super() }}{% endblock %}

{% block content %}
<style>
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 15px 20px;
        background: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    .form-grid .form-group { display: flex; flex-direction: column; }
    .form-grid label { margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
    .form-grid input, .form-grid select, .form-grid textarea {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .form-grid .full-width { grid-column: 1 / -1; }
    .form-grid .submit-button {
        color: white;
        border: none;
        padding: 12px;
        cursor: pointer;
        font-size: 1.1em;
        border-radius: 5px;
    }
    .add-button { background-color: #007bff; }
    .edit-button { background-color: #28a745; }
    .attachment-info {
        background-color: #e9ecef;
        padding: 10px;
        border-radius: 5px;
        font-size: 0.9em;
    }
</style>

<div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
    <h2>ç¶­è­·åˆç´„è³‡æ–™</h2>
    <a href="{{ url_for('list_contracts') }}" class="button" style="background-color: #6c757d;">è¿”å›ç¸½è¦½</a>
</div>


<form action="{{ action_url }}" method="post" class="form-grid" enctype="multipart/form-data">
    <h3>{% if contract %}ç·¨è¼¯åˆç´„{% else %}æ–°å¢åˆç´„{% endif %}</h3>
    <div class="form-group full-width"></div>
    <div class="form-group">
        <label for="VendorName">å» å•†åç¨±</label>
        <input type="text" id="VendorName" name="VendorName" value="{{ contract.VendorName or '' }}" required>
    </div>
    <div class="form-group">
        <label for="ContractType">åˆç´„é¡å‹</label>
        <input type="text" id="ContractType" name="ContractType" value="{{ contract.ContractType or '' }}" required>
    </div>
    
    <div class="form-group full-width">
        <label for="Subject">åˆç´„ä¸»æ—¨</label>
        <input type="text" id="Subject" name="Subject" value="{{ contract.Subject or '' }}">
    </div>
    <div class="form-group full-width">
        <label for="Content">åˆç´„å…§å®¹</label>
        <textarea id="Content" name="Content" rows="4">{{ contract.Content or '' }}</textarea>
    </div>

    <div class="form-group">
        <label for="Amount">åˆç´„é‡‘é¡</label>
        <input type="number" id="Amount" name="Amount" value="{{ contract.Amount or 0 }}" required>
    </div>
     <div class="form-group">
        <label for="Status">åˆç´„ç‹€æ…‹</label>
        <select id="Status" name="Status" required>
            <option value="åŸ·è¡Œä¸­" {% if contract.Status == 'åŸ·è¡Œä¸­' %}selected{% endif %}>åŸ·è¡Œä¸­</option>
            <option value="å·²åˆ°æœŸ" {% if contract.Status == 'å·²åˆ°æœŸ' %}selected{% endif %}>å·²åˆ°æœŸ</option>
            <option value="å·²çºŒç´„" {% if contract.Status == 'å·²çºŒç´„' %}selected{% endif %}>å·²çºŒç´„</option>
            <option value="ä¸­æ­¢" {% if contract.Status == 'ä¸­æ­¢' %}selected{% endif %}>ä¸­æ­¢</option>
        </select>
    </div>
    <div class="form-group">
        <label for="StartDate">é–‹å§‹æ—¥æœŸ</label>
        <input type="date" id="StartDate" name="StartDate" value="{{ contract.StartDate.strftime('%Y-%m-%d') if contract.StartDate else '' }}" required>
    </div>
    <div class="form-group">
        <label for="EndDate">çµæŸæ—¥æœŸ</label>
        <input type="date" id="EndDate" name="EndDate" value="{{ contract.EndDate.strftime('%Y-%m-%d') if contract.EndDate else '' }}" required>
    </div>
    <div class="form-group">
        <label for="ContactPerson">å» å•†è¯çµ¡äºº</label>
        <input type="text" id="ContactPerson" name="ContactPerson" value="{{ contract.ContactPerson or '' }}">
    </div>
    <div class="form-group">
        <label for="ContactPhone">è¯çµ¡äººé›»è©±</label>
        <input type="text" id="ContactPhone" name="ContactPhone" value="{{ contract.ContactPhone or '' }}">
    </div>

    <!-- ===== é™„ä»¶æ¬„ä½ ===== -->
    <div class="form-group full-width">
        {% if contract and contract.attachment_filename %}
            <div class="attachment-info">
                ç›®å‰é™„ä»¶: <a href="{{ url_for('serve_contract_file', file_path=contract.attachment_filename) }}" target="_blank">{{ contract.attachment_filename }}</a>
            </div>
            <label for="attachment" style="margin-top: 10px;">ä¸Šå‚³æ–°æª”ä»¥æ›¿æ› (é¸å¡«)</label>
        {% else %}
            <label for="attachment">ä¸Šå‚³é™„ä»¶ (é¸å¡«)</label>
        {% endif %}
        <input type="file" id="attachment" name="attachment">
    </div>
    <!-- ===================== -->

    <div class="form-group full-width">
        <label for="Notes">å‚™è¨»</label>
        <textarea id="Notes" name="Notes" rows="3">{{ contract.Notes or '' }}</textarea>
    </div>
    <div class="form-group full-width">
        {% if contract %}
        <button type="submit" class="submit-button edit-button">ğŸ’¾ æ›´æ–°è³‡æ–™</button>
        {% else %}
        <button type="submit" class="submit-button add-button">â• æ–°å¢åˆç´„</button>
        {% endif %}
    </div>
</form>

<hr>

<h3>ğŸ“‹ ç¾æœ‰åˆç´„</h3>
<div class="responsive-table">
    <table>
        <thead>
            <tr>
                <th>é™„ä»¶</th>
                <th>å» å•†åç¨±</th>
                <th>åˆç´„ä¸»æ—¨</th>
                <th>çµæŸæ—¥æœŸ</th>
                <th>ç‹€æ…‹</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for c in all_contracts %}
            <tr>
                <td style="text-align: center;">
                    {% if c.attachment_filename %}
                        <a href="{{ url_for('serve_contract_file', file_path=c.attachment_filename) }}" target="_blank" title="æŸ¥çœ‹é™„ä»¶" style="font-size: 1.5em; text-decoration: none;">ğŸ“</a>
                    {% endif %}
                </td>
                <td>{{ c.VendorName }}</td>
                <td>{{ c.Subject }}</td>
                <td>{{ c.EndDate.strftime('%Y-%m-%d') if c.EndDate else '' }}</td>
                <td>{{ c.Status }}</td>
                <td>
                    <a href="{{ url_for('edit_contract_page', contract_id=c.ContractID) }}" style="text-decoration: none; font-size: 1.2em;" title="ç·¨è¼¯">âœï¸</a>
                    <form action="{{ url_for('delete_contract') }}" method="post" style="display:inline;" onsubmit="return confirm('æ‚¨ç¢ºå®šè¦åˆªé™¤ã€Œ{{ c.VendorName }}ã€é€™ç­†åˆç´„å—ï¼Ÿ');">
                        <input type="hidden" name="contract_id" value="{{ c.ContractID }}">
                        <button type="submit" style="background:none; border:none; color:red; cursor:pointer; padding:0; font-size:1.2em;" title="åˆªé™¤">ğŸ—‘ï¸</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
